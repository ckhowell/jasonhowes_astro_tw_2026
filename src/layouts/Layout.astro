---
import "../styles/global.css";
import { ViewTransitions } from 'astro:transitions';

interface Props {
  title?: string;
  description?: string;
}

const {
  title = "Jason Howes | Crystal Ball Recruiting | 91% Accurate Sales Hiring",
  description = "Stop gambling on gut feel. 50% of sales hires failâ€”yours don't have to. Jason Howes uses 91% accurate, science-backed assessments to identify the top 20% of sales professionals before you invest $200K."
} = Astro.props;

const keywords = "sales recruitment Australia, sales DNA assessment, hire salespeople Brisbane, sales hiring mistakes, BDM recruitment, sales team assessment, sales candidate testing, Crystal Ball Recruiting, Jason Howes, Arrow Executive Sales";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content="Jason Howes" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={Astro.url.href} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="/jason-howes-og.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="/jason-howes-og.jpg" />
    <meta name="twitter:creator" content="@jasonhowes" />

    <!-- Additional SEO -->
    <meta property="og:site_name" content="Jason Howes - Crystal Ball Recruiting" />
    <meta property="og:locale" content="en_AU" />

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Critical CSS inline for fonts -->
    <style is:inline>
      /* System font stack fallback */
      html {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      /* Prevent CLS from font swap */
      @font-face {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 400 700;
        font-display: swap;
        src: local('Inter');
      }
      @font-face {
        font-family: 'Mona Sans';
        font-style: normal;
        font-weight: 400 700;
        font-display: swap;
        src: local('Mona Sans');
      }
    </style>

    <!-- Load Google Fonts with display=swap -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Mona+Sans:ital,wght@0,400..700;1,400..700&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Mona+Sans:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet" />
    </noscript>

    <!-- Load Boxicons asynchronously -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css" rel="stylesheet" />
    </noscript>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6KTY18J9KM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-6KTY18J9KM');
    </script>

    <!-- Theme detection - runs immediately to prevent flash -->
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('color-theme');
        if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>

    <!-- View Transitions -->
    <ViewTransitions />

    <!-- Page transition styles -->
    <style is:inline>
      /* Page loader */
      #page-loader {
        position: fixed;
        inset: 0;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #dee7f4;
        transition: opacity 0.4s ease-out, visibility 0.4s ease-out;
      }
      .dark #page-loader {
        background: #0a1520;
      }
      #page-loader.hidden {
        opacity: 0;
        visibility: hidden;
      }
      #page-loader svg {
        width: 120px;
        height: auto;
        animation: pulse-scale 1.2s ease-in-out infinite;
      }
      #page-loader svg path {
        fill: #244a78;
      }
      .dark #page-loader svg path {
        fill: #8ab4e0;
      }
      @keyframes pulse-scale {
        0%, 100% { transform: scale(1); opacity: 0.8; }
        50% { transform: scale(1.1); opacity: 1; }
      }

      /* View Transitions - Left to right wipe */
      ::view-transition-old(root) {
        animation: wipe-out 0.4s ease-in-out forwards;
      }
      ::view-transition-new(root) {
        animation: wipe-in 0.4s ease-in-out forwards;
      }
      @keyframes wipe-out {
        from { clip-path: inset(0 0 0 0); }
        to { clip-path: inset(0 0 0 100%); }
      }
      @keyframes wipe-in {
        from { clip-path: inset(0 100% 0 0); }
        to { clip-path: inset(0 0 0 0); }
      }

      /* Respect reduced motion */
      @media (prefers-reduced-motion: reduce) {
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation: none;
        }
        #page-loader svg {
          animation: none;
        }
      }
    </style>
  </head>
  <body class="font-sans bg-brand-50 dark:bg-brand-950 text-brand-700 dark:text-brand-300">
    <!-- Page Loader -->
    <div id="page-loader" aria-hidden="true">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 655.4 371.7">
        <path d="M275.3,124.8c2.8-7.2-.8-15.1-7.9-17.9-7.1-2.8-15.1.8-17.9,7.9-27.7,69.6-76.3,164.9-143.9,201.3-16.9,9.3-57.4,19.9-69.9.7-4.4-6.9-4.6-16.2-1.8-24.1,6.2-17.5,20.1-31.7,33.8-44.1,7.2-6.7,15.1-12.3,21.9-19.4h0c1.7-1.9-1.2-4.5-3-2.6-6.8,6.5-15,11.9-22.3,18-18.9,15.6-39.1,35-41.7,60.9-1.6,34.7,34,43,61.7,37.8,76.2-14.2,133.2-100.2,166.6-164.5,8.9-17.6,17.2-35.5,24.3-54Z"/>
        <path d="M622.5,150.1c-56.4,5-112.6,10.1-168.6,18.8,4.4-9.4,8.6-18.9,12.6-28.5,14.2-34.6,24.9-70.8,32.6-107.2h0c1.5-8.9-11-11.8-13.6-3.3-6.6,23.5-14.1,46.6-23.2,69-6.7,16.8-14.6,33.3-22.8,49.4-4.4,8.5-9.1,16.9-13.8,25.3-42.2,7.6-84.1,18.3-125,31.4,1.4-2.4,2.8-4.8,4.1-7.2,17.3-30.2,35.9-60.6,47.7-93.6h-.1c1.8-5.1-5.5-7.7-7.4-2.8-.9,2.2-2.8,6.7-3.7,8.9-.8,1.7-3.3,7.1-4.1,8.7-12.7,25-29.3,47.5-45.5,70.5-5.6,8-11.3,16-16.9,24.1-4.1,1.4-8.2,2.9-12.3,4.3h0c-7.4,2.6-11.1,11-8,18.2.6,1.4,1.4,2.6,2.3,3.6-8.1,12.1-16.1,24.2-24.1,36.5-4.3,6.5-1.9,15.5,5.1,18.9,6.5,3.2,14.4.6,17.6-6l5.8-11.6c3.8-7.5,8-15.6,11.9-23,2.7-5,5.4-10.1,8.2-15.1,43.2-18.3,87.4-34,132.7-46.1-19.6,32.3-41.1,63.4-63,94.3-10.4,18.3,15,33.9,26.7,16.7,24.1-38.7,47.8-78,68.1-118.9,58.3-13.6,117.7-22.9,176.9-32.1.9-.1,1.4-.8,1.4-1.7,0-.9-.9-1.5-1.8-1.5Z"/>
      </svg>
    </div>

    <slot />

    <!-- Defer non-critical scripts -->
    <script>
      // Lazy load analytics after page is interactive
      if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
          // Add your analytics script here when ready
          // Example: loadGoogleAnalytics('G-XXXXXXXXXX');
        });
      }
    </script>

    <!-- Page loader script -->
    <script>
      // Hide loader on initial page load
      const hideLoader = () => {
        const loader = document.getElementById('page-loader');
        if (loader) {
          loader.classList.add('hidden');
          // Remove from DOM after transition
          setTimeout(() => {
            loader.style.display = 'none';
          }, 400);
        }
      };

      // Initial load
      if (document.readyState === 'complete') {
        hideLoader();
      } else {
        window.addEventListener('load', hideLoader);
      }

      // Handle View Transitions
      document.addEventListener('astro:before-preparation', () => {
        const loader = document.getElementById('page-loader');
        if (loader) {
          loader.style.display = 'flex';
          loader.classList.remove('hidden');
        }
      });

      document.addEventListener('astro:page-load', () => {
        hideLoader();
      });
    </script>
  </body>
</html>

<style is:global>
  html,
  body {
    margin: 0;
    width: 100%;
    min-height: 100%;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
